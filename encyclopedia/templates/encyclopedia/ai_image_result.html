{% extends "encyclopedia/layout.html" %}

{% block title %}AI Image Result - Wiki{% endblock %}

{% block body %}
<div class="container">
    <h1 class="mb-4">
        <i class="fas fa-robot text-primary me-2"></i>
        AI Image Result
    </h1>
    
    {% if success %}
    <div class="alert alert-success">
        <h4><i class="fas fa-check-circle me-2"></i>Image Generated Successfully!</h4>
        <p class="mb-0">
            Prompt: <strong>"{{ prompt }}"</strong> | 
            Time: {{ generation_time }} seconds
        </p>
    </div>
    
    <div class="card mb-4">
        <div class="card-body text-center">
            <img src="{{ image_url }}" 
                 alt="AI generated image: {{ prompt }}"
                 class="img-fluid rounded shadow mb-4"
                 style="max-height: 500px; max-width: 100%;">
            
            <div class="d-flex flex-wrap gap-2 justify-content-center">
                <button onclick="downloadImage()" class="btn btn-success">
                    <i class="fas fa-download me-2"></i>Save Image
                </button>
                <button onclick="copyMarkdown()" class="btn btn-info">
                    <i class="fas fa-code me-2"></i>Copy Markdown
                </button>
                <a href="{% url 'new_page' %}" class="btn btn-primary">
                    <i class="fas fa-file-alt me-2"></i>Use in Wiki
                </a>
                <a href="{% url 'generate_ai_image' %}" class="btn btn-outline-primary">
                    <i class="fas fa-redo me-2"></i>Generate Another
                </a>
            </div>
        </div>
    </div>
    
    <script>
    function downloadImage() {
        const img = document.querySelector('img');
        const link = document.createElement('a');
        link.href = img.src;
        link.download = 'ai-generated-{{ prompt|slugify }}.png';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        alert('Image download started!');
    }
    
    function copyMarkdown() {
        const markdown = `![AI generated: {{ prompt }}]({{ image_url }})`;
        navigator.clipboard.writeText(markdown).then(() => {
            alert('Markdown copied!');
        });
    }
    </script>
    
    {% else %}
    <div class="alert alert-danger">
        <h4><i class="fas fa-exclamation-triangle me-2"></i>Image Generation Failed</h4>
        <p>{{ error_message|default:"The AI service is currently busy. Please try again later." }}</p>
        <div class="mt-3">
            <a href="{% url 'generate_ai_image' %}" class="btn btn-primary">
                <i class="fas fa-redo me-2"></i>Try Again
            </a>
            <a href="{% url 'index' %}" class="btn btn-outline-secondary">
                <i class="fas fa-home me-2"></i>Back to Home
            </a>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
